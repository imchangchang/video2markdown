# Video2Markdown 需求文档

## 1. 功能需求

### 1.1 核心功能

| 功能 | 描述 | 优先级 |
|-----|------|-------|
| 视频转文字 | 使用 Whisper 将视频音频转为带时间戳的文字稿 | P0 |
| 繁简转换 | 自动将转录结果转为简体中文 | P0 |
| 章节划分 | AI 根据内容主题自动划分章节 | P0 |
| 内容摘要 | AI 为每个章节生成内容摘要 | P0 |
| 关键帧提取 | 从视频中提取代表性关键帧 | P0 |
| 图像分析 | AI 分析关键帧内容，生成描述 | P1 |
| Markdown 生成 | 输出结构化 Markdown 文档 | P0 |

### 1.2 输入输出

**输入**：
- 视频文件格式：MP4, AVI, MOV, MKV, FLV, WMV
- 音频编码：AAC, MP3, WAV 等常见格式
- 语言：中文（繁体/简体）

**输出**：
- Markdown 文档（`.md`）
- 字幕文件（`.srt`）
- 关键帧图片（`{filename}_frames/`）
- 摘要文件（`{filename}_summary.md`）

### 1.3 文档格式要求

生成的 Markdown 文档应包含：

1. **目录导航**：可点击跳转到各章节
2. **章节标题**：AI 生成的中文标题
3. **时间戳**：章节起止时间
4. **内容摘要**：AI 生成的章节总结
5. **相关画面**：关键帧图片及描述
6. **原始文字**：可折叠的完整转录内容

## 2. 技术需求

### 2.1 AI 模型

| 用途 | 模型 | 说明 |
|-----|------|------|
| 文档生成 | kimi-k2.5 | 文字理解、章节划分、摘要生成 |
| 图像理解 | kimi-k2.5 | 分析关键帧内容 |
| 语音识别 | whisper.cpp | 本地语音转文字 |

### 2.2 性能要求

| 指标 | 目标值 |
|-----|-------|
| 语音转录 | 实时率 < 2x（1分钟音频 < 2秒处理） |
| AI 图片分析 | < 20秒/张 |
| 内存占用 | < 2GB |

### 2.3 图片筛选策略

为减少 API 调用，实现智能图片筛选：

1. **颜色分析**：检测 PPT/白板类画面（白色/浅色背景）
2. **文字检测**：使用边缘检测判断文字密度
3. **转录分析**：检查对应时段转录是否提及视觉内容
4. **跳过规则**：
   - 过渡画面（无显著文字）
   - 模糊画面
   - 纯人物画面（无 PPT/板书）

## 3. 非功能需求

### 3.1 可用性

- 提供一键安装脚本（`setup.sh`）
- 提供批量处理脚本（`run_batch.sh`）
- 清晰的错误提示和日志输出
- 进度条显示处理进度

### 3.2 可配置性

通过环境变量或 `.env` 文件配置：

- API Key 和模型选择
- 关键帧采样间隔
- 语言设置
- 临时文件路径

### 3.3 安全性

- API Key 存储在 `.env` 文件，不上传 Git
- 敏感文件加入 `.gitignore`
- 支持本地 Whisper，减少云端依赖

### 3.4 可维护性

- 模块化代码结构
- 完善的单元测试
- 类型注解
- 符合 PEP8 规范

## 4. 未来规划

### 4.1 短期优化

- [ ] 时间戳链接功能，可跳转到视频对应位置
- [ ] 支持更多输出格式（PDF, Word）
- [ ] 支持多语言（英文、日文）
- [ ] 并行处理多个视频

### 4.2 长期规划

- [ ] Web UI 界面
- [ ] 视频数据库管理
- [ ] 全文搜索功能
- [ ] 支持在线视频链接（YouTube, Bilibili）

## 5. 依赖列表

### 5.1 Python 依赖

```
openai>=1.0.0
click>=8.0.0
tqdm>=4.65.0
pydantic>=2.0.0
pydantic-settings>=2.0.0
opencv-python>=4.8.0
Pillow>=10.0.0
ffmpeg-python>=0.2.0
opencc-python-reimplemented>=0.1.7
```

### 5.2 系统依赖

- FFmpeg
- CMake
- Python 3.10+

### 5.3 可选依赖

```
pytest>=7.0.0
black>=23.0.0
ruff>=0.1.0
```
