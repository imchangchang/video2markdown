# Video2Markdown æ¶æ„è®¾è®¡

> ğŸ“‹ è¯¦ç»†å¤„ç†æµç¨‹è¯·æŸ¥çœ‹ [WORKFLOW.md](./WORKFLOW.md)

## 1. ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Video2Markdown                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CLI Layer (cli.py)                                             â”‚
â”‚  â”œâ”€â”€ å‘½ä»¤è¡Œå‚æ•°è§£æ                                              â”‚
â”‚  â”œâ”€â”€ å¤„ç†æµç¨‹ç¼–æ’                                                â”‚
â”‚  â””â”€â”€ è¿›åº¦æ˜¾ç¤ºå’Œé”™è¯¯å¤„ç†                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Core Processing Layer                                          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Video      â”‚  Audio      â”‚  ASR        â”‚  Vision          â”‚ â”‚
â”‚  â”‚  (video.py) â”‚  (audio.py) â”‚  (asr.py)   â”‚  (vision.py)     â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ â€¢ è§†é¢‘ä¿¡æ¯   â”‚ â€¢ éŸ³é¢‘æå–   â”‚ â€¢ Whisper   â”‚ â€¢ å…³é”®å¸§æå–      â”‚ â”‚
â”‚  â”‚ â€¢ å…³é”®å¸§    â”‚ â€¢ æ ¼å¼è½¬æ¢   â”‚ â€¢ ç¹ç®€è½¬æ¢   â”‚ â€¢ å›¾ç‰‡ç­›é€‰        â”‚ â”‚
â”‚  â”‚   æå–      â”‚             â”‚ â€¢ åˆ†æ®µå¤„ç†   â”‚ â€¢ AI å›¾åƒåˆ†æ     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Document Layer (document.py)                                   â”‚
â”‚  â”œâ”€â”€ ç« èŠ‚åˆ’åˆ†                                                    â”‚
â”‚  â”œâ”€â”€ å†…å®¹æ‘˜è¦ç”Ÿæˆ                                                â”‚
â”‚  â””â”€â”€ Markdown æ¸²æŸ“                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Config Layer (config.py)                                       â”‚
â”‚  â”œâ”€â”€ ç¯å¢ƒå˜é‡ç®¡ç†                                                â”‚
â”‚  â””â”€â”€ é…ç½®éªŒè¯                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. å¤„ç†æµç¨‹

```
è¾“å…¥è§†é¢‘
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è§†é¢‘åˆ†æ  â”‚â”€â”€â–º è·å–æ—¶é•¿ã€åˆ†è¾¨ç‡ã€FPS
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. éŸ³é¢‘æå–  â”‚â”€â”€â–º æå–ä¸º WAV æ ¼å¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è¯­éŸ³è¯†åˆ«  â”‚â”€â”€â–º Whisper è½¬å½• â”€â”€â–º OpenCC ç¹ç®€è½¬æ¢
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å…³é”®å¸§   â”‚â”€â”€â–º åœºæ™¯æ£€æµ‹ + å‡åŒ€é‡‡æ ·
â”‚    æå–     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. å›¾ç‰‡ç­›é€‰  â”‚â”€â”€â”€â”€â–ºâ”‚ â€¢ é¢œè‰²åˆ†æï¼ˆPPT/ç™½æ¿æ£€æµ‹ï¼‰    â”‚
â”‚             â”‚     â”‚ â€¢ æ–‡å­—æ£€æµ‹ï¼ˆè¾¹ç¼˜å¯†åº¦ï¼‰        â”‚
â”‚             â”‚     â”‚ â€¢ è½¬å½•ä¸Šä¸‹æ–‡åˆ†æ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼ (ç­›é€‰å)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. AI å›¾åƒ   â”‚â”€â”€â–º Kimi Vision API åˆ†æ
â”‚    åˆ†æ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. AI æ–‡æ¡£   â”‚â”€â”€â–º ç« èŠ‚åˆ’åˆ† + æ‘˜è¦ç”Ÿæˆ
â”‚    ç”Ÿæˆ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
è¾“å‡º Markdown
```

## 3. æ¨¡å—è¯¦ç»†è®¾è®¡

### 3.1 CLI (cli.py)

```python
class VideoProcessor:
    def process(self, video_path, output_path, options)
        # 1. åˆ†æè§†é¢‘
        # 2. è½¬å½•éŸ³é¢‘
        # 3. æå–å…³é”®å¸§
        # 4. åˆ†æå›¾ç‰‡
        # 5. ç”Ÿæˆæ–‡æ¡£
```

### 3.2 ASR (asr.py)

```python
@dataclass
class TranscriptSegment:
    start_time: float    # å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰
    end_time: float      # ç»“æŸæ—¶é—´ï¼ˆç§’ï¼‰
    text: str           # æ–‡æœ¬å†…å®¹ï¼ˆç®€ä½“ä¸­æ–‡ï¼‰

class WhisperTranscriber:
    def transcribe(audio_path) -> list[TranscriptSegment]
    def to_simplified_chinese(text) -> str  # OpenCC è½¬æ¢
```

### 3.3 Vision (vision.py)

```python
class ImageAnalyzer:
    def extract_keyframes(video_path, interval) -> list[Keyframe]
    
    def should_analyze_image(image_path, transcript) -> tuple[bool, str]
        # 1. æ£€æŸ¥æ˜¯å¦æ˜¯ PPT/ç™½æ¿ï¼ˆé¢œè‰²åˆ†æï¼‰
        # 2. æ£€æŸ¥æ–‡å­—å¯†åº¦ï¼ˆè¾¹ç¼˜æ£€æµ‹ï¼‰
        # 3. æ£€æŸ¥è½¬å½•ä¸Šä¸‹æ–‡
        
    def analyze_with_ai(image_path, context) -> str
        # è°ƒç”¨ Kimi Vision API
```

### 3.4 Document (document.py)

```python
class DocumentGenerator:
    def generate(transcript, images) -> str
        chapters = self.create_chapters(transcript)
        return self.render_markdown(chapters, images)
    
    def create_chapters(transcript) -> list[Chapter]
        # ä½¿ç”¨ Kimi åˆ†æå†…å®¹ï¼Œåˆ’åˆ†ç« èŠ‚
        
    def render_markdown(chapters, images) -> str
        # æ¸²æŸ“ä¸º Markdown æ ¼å¼
```

## 4. æ•°æ®æµ

### 4.1 è½¬å½•æ•°æ®

```
Whisper JSON Output
    â”‚
    â–¼
TranscriptSegment[]
    â”œâ”€â”€ start_time: float
    â”œâ”€â”€ end_time: float
    â””â”€â”€ text: str (ç®€ä½“ä¸­æ–‡)
```

### 4.2 å…³é”®å¸§æ•°æ®

```
Keyframe
    â”œâ”€â”€ frame_path: Path
    â”œâ”€â”€ timestamp: float
    â”œâ”€â”€ image_type: str  # ppt, whiteboard, speaker, etc.
    â””â”€â”€ description: str  # AI ç”Ÿæˆæè¿°
```

### 4.3 ç« èŠ‚æ•°æ®

```
Chapter
    â”œâ”€â”€ title: str
    â”œâ”€â”€ start_time: float
    â”œâ”€â”€ end_time: float
    â”œâ”€â”€ summary: str      # AI ç”Ÿæˆæ‘˜è¦
    â”œâ”€â”€ transcript: str   # åŸå§‹è½¬å½•
    â””â”€â”€ images: list[Keyframe]  # ç›¸å…³å›¾ç‰‡
```

## 5. å…³é”®è®¾è®¡å†³ç­–

### 5.1 Text-First è®¾è®¡

- **æ ¸å¿ƒåŸåˆ™**ï¼šæ–‡å­—å†…å®¹æ˜¯ä¸»ä½“ï¼Œå›¾ç‰‡æ˜¯è¾…åŠ©
- **å®ç°æ–¹å¼**ï¼š
  - ä¼˜å…ˆä½¿ç”¨ Whisper è½¬å½•çš„å®Œæ•´å†…å®¹
  - AI ç« èŠ‚åˆ’åˆ†åŸºäºæ–‡å­—å†…å®¹
  - å›¾ç‰‡ä»…ç”¨äºè¡¥å……æ–‡å­—æ— æ³•è¡¨è¾¾çš„ä¿¡æ¯

### 5.2 æ™ºèƒ½å›¾ç‰‡ç­›é€‰

**ç›®çš„**ï¼šå‡å°‘ä¸å¿…è¦çš„ API è°ƒç”¨ï¼Œé™ä½æˆæœ¬å’Œæ—¶é—´

**ç­–ç•¥**ï¼š

| ç­›é€‰å±‚çº§ | æ–¹æ³• | èŠ‚çœç‡ |
|---------|------|-------|
| ç¬¬ä¸€å±‚ | é¢œè‰²åˆ†æï¼ˆæ£€æµ‹ PPT/ç™½æ¿ï¼‰ | 30% |
| ç¬¬äºŒå±‚ | æ–‡å­—å¯†åº¦æ£€æµ‹ï¼ˆOpenCVï¼‰ | 20% |
| ç¬¬ä¸‰å±‚ | è½¬å½•ä¸Šä¸‹æ–‡åˆ†æ | 20% |

### 5.3 æ¨¡å‹é€‰æ‹©

| ç”¨é€” | æ¨¡å‹ | ç†ç”± |
|-----|------|------|
| è¯­éŸ³è¯†åˆ« | whisper.cpp (local) | å…è´¹ã€ç¦»çº¿ã€ä¿æŠ¤éšç§ |
| æ–‡æœ¬ç”Ÿæˆ | kimi-k2.5 | ä¸­æ–‡ç†è§£èƒ½åŠ›å¼ºã€ä¸Šä¸‹æ–‡é•¿ |
| å›¾åƒç†è§£ | kimi-k2.5 | æ”¯æŒè§†è§‰ã€æ€§ä»·æ¯”é«˜ |

### 5.4 é”™è¯¯å¤„ç†ç­–ç•¥

- **å¯æ¢å¤é”™è¯¯**ï¼šè·³è¿‡å½“å‰æ­¥éª¤ï¼Œç»§ç»­å¤„ç†ï¼ˆå¦‚å•å¼ å›¾ç‰‡åˆ†æå¤±è´¥ï¼‰
- **å…³é”®é”™è¯¯**ï¼šç»ˆæ­¢å¤„ç†ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚è§†é¢‘æ–‡ä»¶ä¸å­˜åœ¨ï¼‰
- **é™çº§ç­–ç•¥**ï¼šå¦‚æœ AI æœåŠ¡ä¸å¯ç”¨ï¼Œä»è¾“å‡ºåŸºç¡€è½¬å½•å’Œå…³é”®å¸§

## 6. æ‰©å±•æ€§è®¾è®¡

### 6.1 æ·»åŠ æ–°çš„ ASR æä¾›å•†

```python
# asr.py
class BaseTranscriber(ABC):
    @abstractmethod
    def transcribe(self, audio_path) -> list[TranscriptSegment]:
        pass

class WhisperTranscriber(BaseTranscriber): ...
class OpenAITranscriber(BaseTranscriber): ...
class AzureTranscriber(BaseTranscriber): ...  # æ–°å¢
```

### 6.2 æ·»åŠ æ–°çš„è¾“å‡ºæ ¼å¼

```python
# document.py
class BaseRenderer(ABC):
    @abstractmethod
    def render(self, chapters) -> str:
        pass

class MarkdownRenderer(BaseRenderer): ...
class PDFRenderer(BaseRenderer): ...  # æ–°å¢
class WordRenderer(BaseRenderer): ...  # æ–°å¢
```

## 7. é…ç½®ä½“ç³»

```
é…ç½®ä¼˜å…ˆçº§ï¼ˆé«˜åˆ°ä½ï¼‰ï¼š

1. å‘½ä»¤è¡Œå‚æ•°
   â””â”€â”€ video2md process --keyframe-interval 60
   
2. ç¯å¢ƒå˜é‡
   â””â”€â”€ export KIMI_KEYFRAME_INTERVAL=60
   
3. .env æ–‡ä»¶
   â””â”€â”€ KIMI_KEYFRAME_INTERVAL=60
   
4. é»˜è®¤å€¼
   â””â”€â”€ ä»£ç ä¸­å®šä¹‰çš„é»˜è®¤å€¼
```
